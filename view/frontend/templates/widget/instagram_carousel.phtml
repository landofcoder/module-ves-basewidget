<?php

/*Owl Carousel Setting*/
$_vesHelper = $this->helper('Ves\BaseWidget\Helper\Productlist');
$autoSpeed = $this->getConfig("autospeed", 1000);
$animateOut = $this->getConfig('animateout','0');
$animateIn = $this->getConfig('animatein','0');
$nav_speed = $this->getConfig('nav_speed', 800);
$dots_speed = $this->getConfig('dots_speed', 800);
$autoplay_hover = $this->getConfig('autoplay_hover');
$dots = $this->getConfig('dots');
$autoplay_timeout = $this->getConfig('autoplay_timeout');
$pullDrag = $this->getConfig('pulldrag');

$carousel_responsive = 1;
$cols = (int)$default_items;
$cols = !empty($cols)?(int)$cols:4;
$itemsperpage = 1;

$auto_play = $auto_play_mode?"true":"false";

$enable_custom_nav = $this->getConfig('enable_custom_nav', 1);
$next_icon_class = $this->getConfig('next_icon_class', 'fa fa-angle-right');
$previous_icon_class = $this->getConfig('previous_icon_class', 'fa fa-angle-left');
$autoheight = $this->getConfig('autoheight', 0);
$autowidth = $this->getConfig('autowidth', 0);
$lazyLoad = $this->getConfig('lazyLoad', 0);

$enable_collapse = $this->getConfig("enable_collapse", 0);
$default_items = $cols;
$cols = 1;
$span = 12/$cols;
$active = 'latest';
$moduleId = rand().time();
$custom_id = $this->getConfig("custom_id", "");
$cmsblock = $this->getConfig('cmsblock');
$pretext_html = $this->getConfig('pretext');
$html = '';
if($cmsblock === 'pretext_html'){
    $html = base64_decode($pretext_html);
}elseif($cmsblock!=''){
    $html = $this->getCmsBlockModel()->load($cmsblock)->getContent();
}
$html = $_vesHelper->filter($html);
?>
<?php if( count($this->getInstagram()) ) { ?>
<div id="<?= $custom_id?$custom_id:('ves-instagram-carousel-'.$moduleId);?>" class="ves-widget block instagram_carousel_widget owlinstagramcarousel <?= $addition_cls; ?> <?php if (isset($stylecls)&&$stylecls) echo 'block-'.$stylecls;?>">
      <?php if (isset($widget_heading)&&!empty($widget_heading)): ?>
      <div class="block-title">
            <?php if($enable_collapse): ?><span class="opener hidden-lg hidden-md" data-toggle="collapse" data-target="#widget-instagram-carousel<?= $moduleId; ?>"><i class="fa fa-angle-down"></i></span><?php endif; ?>
            <h2><span><?= $widget_heading; ?></span></h2>
      </div>
      <?php endif; ?>
      <?php if($html){ ?>
      <div class="pretext-html">
            <?= $html;?>
      </div>
      <?php } ?>

      <div id="widget-instagram-carousel<?= $moduleId; ?>" class="widget-inner block-content <?php if($enable_collapse): ?> widget-enanle-collapse collapse in <?php endif; ?>">
            <div class="box-instagrams carousel slide">
                  <div id="owlinstagramcarousel<?= $moduleId;?>" class="owl-carousel">
                        <?php
                              $pages = array_chunk( $this->getInstagram(), $itemsperpage);
                        ?>
                        <?php $number = 0; ?>
                        <?php foreach ($pages as  $k => $tmpinstagram ):  ?>
                                    <div class="item <?php if($k==0) {?>first<?php } elseif($k == (count($pages) -1 )) {?>last<?php } ?> instagrams-grid no-margin">
                                    <?php foreach( $tmpinstagram as $i => $media ) {  $i=$i+1;?>
                                    <?php if( $cols == 1 || $i%$cols == 1 ) { ?>
                                    <div class="item-row">
                                          <?php } ?>
                                          <div class="item-instagram">
                                          <a class="colorbox-instagram_<?= $number; ?>" href="#instagram-detail_<?= $number; ?>" >
                                                <img style="width: <?= $this->getWidthinconfig() ?>px; height: <?= $this->getHeightinconfig() ?>px;"  src="<?= $media['image'] ?>" alt="instagram image <?= $number; ?>"/>
                                          </a>
                                          <div class="hidden hide">
                                                <div id="instagram-detail_<?= $number; ?>" >
                                                      <img width="<?= $media['width_large'] ?>" height="<?= $media['height_large'] ?>" class="media" alt="instagram image <?= $number; ?>" src="<?= $media['image_large'] ?>"/>
                                                      <div class="instagram-content">
                                                            <div class="instagram-avatar" style="background-image: url(<?= $media['avatar'] ?>)"></div>
                                                            <p><a target="_blank" href="<?= $media['link'] ?>"><?= $media['username'] ?></a></p>
                                                            <div class="instagram-comment"><?= $media['comment'] ?></div>
                                                      </div>
                                                </div>
                                          </div>
                                    <script type="text/javascript">
                                          require(['jquery'],function($){
                                                $(document).ready(function(){
                                                require([
                                                            'jquery'
                                                            <?php if($this->helper("Ves\All\Helper\Data")->getConfig("enable_colorbox")): ?>
                                                          ,"Ves_All/lib/colorbox/jquery.colorbox.min"
                                                          <?php endif; ?>
                                                            ],function($){

                                                                  $('.colorbox-instagram_<?= $number; ?>').colorbox({inline:true, width:"50%", opacity: 0.7});
                                                                  $('#instagram-detail_<?= $number; ?>').hide();
                                                                  $('.colorbox-instagram_<?= $number; ?>').click(function(){
                                                                        $('#instagram-detail_<?= $number; ?>').show();
                                                                  });
                                                                  $(document).bind('cbox_closed', function(){
                                                                        $('#instagram-detail_<?= $number; ?>').hide();
                                                                  });
                                                      });
                                                });
                                          });
                                          </script>

                                    <?php $number ++; ?>
                                    </div>
                                    <?php if( $cols==1 || $i%$cols == 0 || $i==count($tmpinstagram) ) { ?>
                                    </div>
                              <?php } ?>
                              <?php $number ++; } //endforeach 2?>
                                    </div>
                        <?php endforeach; ?>
                  </div>
                  <?php if($enable_custom_nav){ ?>
            <?php $show_navigator = false; ?>
            <div class="customNavigation">
                  <a class="carousel-prev<?= $moduleId ?>" href="javascript:;" title="<?= __("Prev"); ?>"><i class="<?= $previous_icon_class ?>"></i></a>
                  <a class="carousel-next<?= $moduleId ?>" href="javascript:;" title="<?= __("Next"); ?>"><i class="<?= $next_icon_class ?>"></i></a>
            </div>
            <?php } ?>
      </div>
</div>

</div>
<script type="text/javascript">
require(['jquery'],function($){
      $(document).ready(function(){
      require([
            'jquery'
             <?php if($this->helper("Ves\All\Helper\Data")->getConfig("enable_owlcarousel")): ?>
            ,"Ves_All/lib/owl.carousel/owl.carousel.min"
            <?php endif; ?>
            ],function($){
                var widgetowlcarousel = jQuery('#owlinstagramcarousel<?= $moduleId;?>');
                    widgetowlcarousel.owlCarousel({
                        autoplay: <?= $auto_play_mode?'true':'false';?>,
                        <?php if ($autoSpeed): ?>
                        autoplaySpeed: <?= $autoSpeed; ?>,
                        <?php endif; ?>
                        autoplayTimeout: <?= (int)$autoplay_timeout ?>,
                        <?php if ($animateIn): ?>
                        animateIn: <?= $animateIn?'"'.$animateIn.'"':"false"; ?>,
                        <?php endif; ?>
                        <?php if ($animateOut): ?>
                        animateOut: <?= $animateOut?'"'.$animateOut.'"':"false"; ?>,
                        <?php endif; ?>
                        autoplayHoverPause: <?= $autoplay_hover?"true":"false" ?>,
                        nav: <?= $show_navigator == 1?"true":"false" ?>,
                        navigation: <?= $show_navigator == 1?'true':'false'; ?>,
                        <?php if($show_navigator): ?>
                        navText: ["<span class='fa fa-angle-left'></span>","<span class='fa fa-angle-right'></span>"],
                        <?php endif; ?>
                        autoWidth: <?= $autowidth?"true":"false" ?>,
                        autoHeight: <?= $autoheight?"true":"false" ?>,
                        slideBy: <?= (isset($slide_by) && $slide_by)?(int)$slide_by:1; ?>,
                        loop: <?= $loop == 1?'true':'false'; ?>,
                        margin: <?= $margin_item?(int)$margin_item:'0'; ?>,
                        navSpeed:  <?= $interval?(int)$interval:'false'; ?>,
                        dot: <?= $dots?"true":"false" ?>,
                        dotsSpeed: <?= $dots_speed?(int)$dots_speed:'false'; ?>,
                        mouseDrag: <?= $mouse_drag == 1?'true':'false'; ?>,
                        touchDrag: <?= $touch_drag == 1?'true':'false'; ?>,
                        pullDrag: <?= $pullDrag?"true":"false" ?>,
                        lazyLoad: <?= $lazyLoad?"true":"false" ?>,
                        items: <?= $default_items?(int)$default_items:4; ?>

                        <?php if($mobile_items || $tablet_small_items || $tablet_items || $portrait_items || $large_items): ?>
                        ,responsive: {
                              <?php if($mobile_items): ?>
                              0: {
                                    items: <?= $mobile_items?(int)$mobile_items:1; ?>,
                                    nav: true,
                                    loop: true
                              },
                              <?php endif; ?>
                              <?php if($tablet_small_items): ?>
                              600: {
                                    items: <?= $tablet_small_items?(int)$tablet_small_items:2; ?>,
                                    nav: true,
                                    loop: true
                              },
                              <?php endif; ?>
                              <?php if($tablet_items): ?>
                              767: {
                                    items: <?= $tablet_items?(int)$tablet_items:2; ?>,
                                    nav: true,
                                    loop: true
                              },
                              <?php endif; ?>
                              <?php if($portrait_items): ?>
                              1000: {
                                    items: <?= $portrait_items?(int)$portrait_items:3; ?>,
                                    nav: true,
                                    loop: true
                              },
                              <?php endif; ?>
                              1200: {
                                    items: <?= $default_items?(int)$default_items:4; ?>,
                                    nav: true,
                                    loop: true
                              },
                              <?php if($large_items): ?>
                              1900: {
                                    items: <?= $large_items?(int)$large_items:5; ?>,
                                    nav: true,
                                    loop: true
                              }
                              <?php endif; ?>
                        }
                        <?php endif; ?>
                    });

                  <?php if($enable_custom_nav): // owl custom navigation trigger ?>
                  jQuery(".carousel-prev<?= $moduleId ?>").click(function () {
                        widgetowlcarousel.trigger('prev.owl.carousel');
                        });
                  jQuery(".carousel-next<?= $moduleId ?>").click(function () {
                        widgetowlcarousel.trigger('next.owl.carousel');
                  });
                  <?php endif; ?>
            });
      });
});
</script>
<?php } //end if ?>


